---
title: "Comparing methods for crystal texture quantification"
author: "Bryan Shirley"
date: "2023-06-12"
output:
  html_document: default
  pdf_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
|

```{r importing the data and setting up the libs,echo=FALSE}
library(ggplot2)
library(ggpubr)
library(knitr)
Data = read.csv("../Texture methods comparison/TextureResultsNew.csv", header = T, sep=';')
```

```{r Setting up the box plots,echo=FALSE}


p1 = ggplot(data = Data, aes(x=reorder(Taxa,T.index), y=T.index,fill=Taxa)) + 
  geom_boxplot()

p2 = ggplot(data = Data, aes(x=reorder(Taxa,T.index), y=M.index,fill=Taxa)) + 
  geom_boxplot()

p3 = ggplot(data = Data, aes(x=reorder(Taxa,T.index), y=pfT.index..C.,fill=Taxa
)) + geom_boxplot()

p4 =   
ggplot(data = Data, aes(x=reorder(Taxa,T.index), y=pfT.index..A.,fill=Taxa
)) + geom_boxplot()
  
  p1 = p1 +theme_classic()+theme(legend.position = "none",axis.text.x=element_blank(),axis.ticks.x=element_blank(),
                                 axis.title.x = element_blank(),axis.title.y = element_text(size=9))+
    ylab("T-index")+
    scale_fill_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))

  p2 = p2 +theme_classic()+theme(legend.position = "none",axis.text.x=element_blank(),
                                 axis.ticks.x=element_blank(),axis.title.x = element_blank(),axis.title.y = element_text(size=9))+
    ylab("M-index")+
    scale_fill_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))
  
  p3 = p3 + theme_classic()+theme(legend.position = "none",axis.text.x=element_blank(),
                                  axis.ticks.x=element_blank(),axis.title.x = element_blank(),axis.title.y = element_text(size=8))+
    ylab("pfT-index (C)")+
    scale_fill_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))
  
  p4 = p4 +theme_classic()+theme(legend.position = "none",axis.text.x=element_blank(),
                                 axis.ticks.x=element_blank(),axis.title.x = element_blank(),axis.title.y = element_text(size=8))+
    ylab("pfT-index (A)")+
    scale_fill_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))
```

## All the methods.

Here we plot 3 methods of looking at the texture index of materials. First, we use the texture index (T-index), followed by the misorientation index (M-index) and then the pole figure texture index  (pfT-index) for the A and C axis. 

```{r,echo=FALSE}
ggpubr::ggarrange(p1, p2,p3,p4,
                  labels = c("a", "b", "c","d"),
                  ncol = 2, nrow = 2)
```

## Comparing methods.

Here we use scatter plots to compare the difference between the M-index and t-index 

```{r,echo=FALSE}
sc1= ggplot2::ggplot(Data, aes(y=M.index, x=T.index, color=Taxa, shape=Taxa)) + 
  geom_point(size=2) + 
  ylab(expression("M-index")) + 
  xlab(expression("T-index"))+
  theme_classic()+
  scale_colour_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))+
scale_shape_manual(values=c(4,15,16,17,18,25))+
  geom_point(size=1.5,stroke = 1.5)
sc1

```

## Big combi plot.

This is just a combination plot of the above data.

```{r playing with plots,echo=FALSE}
ggarrange(sc1,                                            
          ggarrange(p1,p2 , ncol = 2, labels = c("b", "c")),
          ggarrange(p3,p4 , ncol = 2, labels = c("d", "e")),
          nrow =3, 
          labels = "a",
           heights = c(1.8, 1,1)
) 
```

## How do things change with area?

It appears that area does have an impact on the T-index values obtained, however the M-index does not have the resolution to decipher the differences between taxa. 

```{r comparing area vs indexes,echo=FALSE}
ggplot2::ggplot(Data, aes(y=T.index, x=Area, color=Taxa, shape=Taxa)) + 
  geom_point(size=2,stroke = 1) + 
  ylab(expression("T-index")) + 
  xlab(expression("Area"))+
  theme_classic()+
  geom_smooth(method=lm,se=FALSE,show.legend=TRUE)+
  theme(legend.position = "none")+
  scale_colour_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))+
  scale_shape_manual(values=c(4,15,16,17,18,25))
  
ggplot2::ggplot(Data, aes(y=M.index, x=Area, color=Taxa, shape=Taxa)) + 
  geom_point(size=2,stroke = 1) + 
  ylab(expression("M-index")) + 
  xlab(expression("Area"))+
  theme_classic()+
  geom_smooth(method=lm,se=FALSE)+
  theme(legend.position = "none")+
  scale_colour_manual(values=c("#aecec5ff","#cad5c1ff","#bf9e66ff","#a36b2bff","#dcd1a2ff", "#2686a0ff"))+ 
  scale_shape_manual(values=c(4,15,16,17,18,25))

```

```{r ,echo=FALSE}
## Make the Matrix ##
Matrix <- matrix(data = 0, nrow = 6, ncol = 3)
 colnames(Matrix) = c('taxa','R squ.','p-value' )
 
## Subset the data ##
Pro <- Data[Data$Taxa == 'Pro.muelleri',]
Pan<- Data[Data$Taxa == 'Pan.equicostatus',]
Exca<- Data[Data$Taxa == 'W. excavata',]
Bisp<- Data[Data$Taxa == 'B. cf. aculeatus',]
Trip<- Data[Data$Taxa == 'T. gracilis',]
Pal<- Data[Data$Taxa =='Palmatolepis sp.',]

## Run reg ##
reg = lm(T.index ~ Area, data = Pro)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

Matrix[1,1] <-'Pro.muelleri'
Matrix[1,2] <-summary(reg)$adj.r.squared
Matrix[1,3] <- pv

##

reg = lm(T.index ~ Area, data = Pan)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

Matrix[2,1] <-'Pan.equicostatus'
Matrix[2,2] <- summary(reg)$adj.r.squared
Matrix[2,3] <- pv

##

reg = lm(T.index ~ Area, data = Exca)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

Matrix[3,1] <-'W. excavata'
Matrix[3,2] <- summary(reg)$adj.r.squared
Matrix[3,3] <- pv

##

reg = lm(T.index ~ Area, data = Bisp)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

Matrix[4,1] <-'B. cf. aculeatus'
Matrix[4,2] <- summary(reg)$adj.r.squared
Matrix[4,3] <- pv
##

reg = lm(T.index ~ Area, data = Trip)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

Matrix[5,1] <-'T. gracilis'
Matrix[5,2] <- summary(reg)$adj.r.squared
Matrix[5,3] <- pv


reg = lm(T.index ~ Area, data = Pal)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

Matrix[6,1] <-'Palmatolepis sp.'
Matrix[6,2] <- summary(reg)$adj.r.squared
Matrix[6,3] <- pv
```
```{r ,echo=FALSE}
## Make the Matrix ##
MatrixM <- matrix(data = 0, nrow = 6, ncol = 3)
 colnames(Matrix) = c('taxa','R squ.','p-value' )
 
## Subset the data ##
Pro <- Data[Data$Taxa == 'Pro.muelleri',]
Pan<- Data[Data$Taxa == 'Pan.equicostatus',]
Exca<- Data[Data$Taxa == 'W. excavata',]
Bisp<- Data[Data$Taxa == 'B. cf. aculeatus',]
Trip<- Data[Data$Taxa == 'T. gracilis',]
Pal<- Data[Data$Taxa =='Palmatolepis sp.',]

## Run reg ##
reg = lm(M.index ~ Area, data = Pro)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

MatrixM[1,1] <-'Pro.muelleri'
MatrixM[1,2] <-summary(reg)$adj.r.squared
MatrixM[1,3] <- pv

##

reg = lm(M.index ~ Area, data = Pan)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

MatrixM[2,1] <-'Pan.equicostatus'
MatrixM[2,2] <- summary(reg)$adj.r.squared
MatrixM[2,3] <- pv

##

reg = lm(M.index ~ Area, data = Exca)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

MatrixM[3,1] <-'W. excavata'
MatrixM[3,2] <- summary(reg)$adj.r.squared
MatrixM[3,3] <- pv

##

reg = lm(M.index ~ Area, data = Bisp)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

MatrixM[4,1] <-'B. cf. aculeatus'
MatrixM[4,2] <- summary(reg)$adj.r.squared
MatrixM[4,3] <- pv
##

reg = lm(M.index ~ Area, data = Trip)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

MatrixM[5,1] <-'T. gracilis'
MatrixM[5,2] <- summary(reg)$adj.r.squared
MatrixM[5,3] <- pv


reg = lm(M.index ~ Area, data = Pal)
#define function to extract overall p-value of model
overall_p <- function(reg) {
    f <- summary(reg)$fstatistic
    p <- pf(f[1],f[2],f[3],lower.tail=F)
    attributes(p) <- NULL
    return(p)}
#extract overall p-value of model
overall_p(reg)
if(overall_p(reg) < 0.005)
pv = "< 0.005"
if(overall_p(reg) > 0.005)
pv = overall_p(reg)

MatrixM[6,1] <-'Palmatolepis sp.'
MatrixM[6,2] <- summary(reg)$adj.r.squared
MatrixM[6,3] <- pv

kable(Matrix)
kable(MatrixM)

```
## How does misindexing effect the results?

